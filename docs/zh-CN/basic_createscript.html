<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Basic - Create Smart Contract Script · neon-js</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Basic - Create Smart Contract Script · neon-js"/><meta property="og:type" content="website"/><meta property="og:url" content="http://cityofzion.io/neon-js/index.html"/><meta property="og:description" content="This is a tutorial for constructing invocation scripts for invoking smart contract functions. This tutorial is specifically targeted at NEP5 contracts as it is currently the most common contract type."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/neon-js/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/neon-js/browser.js"></script><link rel="stylesheet" href="/neon-js/css/main.css"/></head><body class="sideNavVisible doc"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/neon-js/zh-CN"><img class="logo" src="/neon-js/img/logo.svg" alt="neon-js"/><h2 class="headerTitleWithLogo">neon-js</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/neon-js/docs/zh-CN/installation.html" target="_self">文档</a></li><li class=""><a href="/neon-js/docs/zh-CN/api-index.html" target="_self">API</a></li><li class=""><a href="/neon-js/docs/zh-CN/changelog-latest.html" target="_self">Changelog</a></li><li class=""><a href="/neon-js/zh-CN/help.html" target="_self">Help</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/neon-js/img/language.svg"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/neon-js/en">English</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>教程</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>开始</h3><ul><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/overview.html">概述</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/installation.html">安装</a></li></ul></div><div class="navGroup navGroupActive"><h3>教程</h3><ul><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/basic_sendasset.html">Basic - Sending assets</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/basic_claimgas.html">Basic - Claiming Gas</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/neon-js/docs/zh-CN/basic_createscript.html">Basic - Create Smart Contract Script</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/basic_invoke.html">Basic - Invoking a Smart Contract</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/basic_privnet.html">Basic - Using a Private Net</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/adv_multitx.html">Advanced - Sending multiple transactions in a block</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/zh-CN/adv_apicore.html">Advanced - API Core Components</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Basic - Create Smart Contract Script</h1></header><article><div><span><p>This is a tutorial for constructing invocation scripts for invoking smart contract functions. This tutorial is specifically targeted at NEP5 contracts as it is currently the most common contract type.</p>
<p>The example I will be using for this tutorial can be found <a href="https://github.com/neo-project/examples-csharp/blob/master/ICO_Template/ICO_Template.cs">here</a>.</p>
<blockquote>
<p>Do note that this template is very outdated and should not be used as an actual ICO template.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="the-parts"></a><a href="#the-parts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The parts</h2>
<p>We first look at the entry method for the NEP5 contract. The entry method for smart contracts are always named <code>Main</code></p>
<pre><code class="hljs css c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> operation, <span class="hljs-keyword">params</span> <span class="hljs-keyword">object</span>[] args</span>)
</span>{
</code></pre>
<p>There are 2 arguments for the entry method: a string <code>operation</code> and an array <code>args</code>. This means that for every invocation script, the contract expects exactly 2 arguments.</p>
<p>Of course, this style is not enforced and you can have a smart contract that simply accepts an integer as the only argument. However, it is recommended that any complex contract implement this string and array pattern as it is super flexible and tools will most likely be built around serving this pattern.</p>
<h2><a class="anchor" aria-hidden="true" id="simple-calls-with-createscript"></a><a href="#simple-calls-with-createscript" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Simple calls with create.script</h2>
<p>In <code>neon-js</code>, there is a simple way exposed to create an invocation script through the semantic call <code>Neon.create.script</code>. It is an alias for the method <code>Neon.sc.createScript</code>.</p>
<pre><code class="hljs css js"><span class="hljs-keyword">const</span> props = {
  <span class="hljs-attr">scriptHash</span>: <span class="hljs-string">'5b7074e873973a6ed3708862f219a6fbf4d1c411'</span>, <span class="hljs-comment">// Scripthash for the contract</span>
  operation: <span class="hljs-string">'balanceOf'</span>, <span class="hljs-comment">// name of operation to perform.</span>
  args: [Neon.u.reverseHex(<span class="hljs-string">'cef0c0fdcfe7838eff6ff104f9cdec2922297537'</span>)] <span class="hljs-comment">// any optional arguments to pass in. If null, use empty array.</span>
}

<span class="hljs-keyword">const</span> script = Neon.create.script(props)
</code></pre>
<p><code>script</code> is now a hexstring that you can use in an <code>invokescript</code> RPC call or an invocationTransaction.</p>
<pre><code class="hljs css js">Neon.rpc.Query.invokeScript(script)
  .execute(<span class="hljs-string">'http://seed3.neo.org:20332'</span>)
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(res) <span class="hljs-comment">// You should get a result with state: "HALT, BREAK"</span>
  })
</code></pre>
<p>Your console result should look something like this::</p>
<pre><code class="hljs css js">{
    <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
    <span class="hljs-string">"id"</span>: <span class="hljs-number">1234</span>,
    <span class="hljs-string">"result"</span>: {
        <span class="hljs-string">"script"</span>: <span class="hljs-string">"143775292229eccdf904f16fff8e83e7cffdc0f0ce51c10962616c616e63654f666711c4d1f4fba619f2628870d36e3a9773e874705b"</span>,
        <span class="hljs-string">"state"</span>: <span class="hljs-string">"HALT, BREAK"</span>,
        <span class="hljs-string">"gas_consumed"</span>: <span class="hljs-string">"0.338"</span>,
        <span class="hljs-string">"stack"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"ByteArray"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"80778e06"</span> <span class="hljs-comment">// This value will vary</span>
            }
        ]
    }
}
</code></pre>
<p>The <code>value</code> field is our result and we can turn that into a human readable form by parsing it as a Fixed8:</p>
<pre><code class="hljs css js">Neon.u.Fixed8.fromReverseHex(<span class="hljs-string">'80778e06'</span>)
</code></pre>
<blockquote>
<p>This is a generic case for NEP5 tokens with 8 decimals. Some tokens might require different parsing solutions.
This will be covered in another tutorial or you can check out the source code under src/api/nep5 .</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="chaining-scripts"></a><a href="#chaining-scripts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Chaining scripts</h2>
<p>Invocation transactions might be free now so we are fine with sending a transaction for every transfer but in the future, we want to aggregate them so we fully maximise the 10 free gas that we get per transaction. This is achieved by chaining scripts together.</p>
<p><code>create.script</code> has the functionality built-in for us and let's us use it to retrieve all the information about a specific token.</p>
<p>There are many fields that we want to know about in an NEP5 token: name, decimals, total supply, etc. Instead of performing a <code>invokescript</code> RPC call for each field, we will be combining it in a single call. The example we are using here is the testnet contract for Red Pulse.</p>
<pre><code class="hljs css js">  <span class="hljs-keyword">const</span> scriptHash = <span class="hljs-string">'5b7074e873973a6ed3708862f219a6fbf4d1c411'</span> <span class="hljs-comment">// TestNet RPX</span>

  <span class="hljs-keyword">const</span> getName = { scriptHash, <span class="hljs-attr">operation</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">args</span>: [] }
  <span class="hljs-keyword">const</span> getDecimals = { scriptHash, <span class="hljs-attr">operation</span>: <span class="hljs-string">'decimals'</span>, <span class="hljs-attr">args</span>: [] }
  <span class="hljs-keyword">const</span> getSymbol = { scriptHash, <span class="hljs-attr">operation</span>: <span class="hljs-string">'symbol'</span>, <span class="hljs-attr">args</span>: [] }
  <span class="hljs-keyword">const</span> getTotalSupply = { scriptHash, <span class="hljs-attr">operation</span>: <span class="hljs-string">'totalSupply'</span>, <span class="hljs-attr">args</span>: [] }

  <span class="hljs-keyword">const</span> script = Neon.create.script([getName, getDecimals, getSymbol, getTotalSupply])
</code></pre>
<p>Similar to the previous example, our <code>script</code> is now ready to be used in a <code>invokescript</code> RPC call or an invocationTransaction.</p>
<p>Now our result would look like:</p>
<pre><code class="hljs css js">{
    <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
    <span class="hljs-string">"id"</span>: <span class="hljs-number">1234</span>,
    <span class="hljs-string">"result"</span>: {
        <span class="hljs-string">"script"</span>: <span class="hljs-string">"00c1046e616d656711c4d1f4fba619f2628870d36e3a9773e874705b00c108646563696d616c736711c4d1f4fba619f2628870d36e3a9773e874705b00c10673796d626f6c6711c4d1f4fba619f2628870d36e3a9773e874705b00c10b746f74616c537570706c796711c4d1f4fba619f2628870d36e3a9773e874705b"</span>,
        <span class="hljs-string">"state"</span>: <span class="hljs-string">"HALT, BREAK"</span>,
        <span class="hljs-string">"gas_consumed"</span>: <span class="hljs-string">"0.646"</span>,
        <span class="hljs-string">"stack"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"ByteArray"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"5265642050756c736520546f6b656e20332e312e34"</span>
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"Integer"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"8"</span>
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"ByteArray"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"525058"</span>
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"ByteArray"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"00f871f54c710f"</span>
            }
        ]
    }
}
</code></pre>
<p>We can see that the result stack returns the results in the order of our scripts. The first result <code>5265642050756c736520546f6b656e20332e312e34</code> is the hexstring representation of the name of the token. The second result is the decimal places. The third result is the symbol in hexstring and the last result is the total supply in Fixed8 format.</p>
<p>This last bit in parsing is intentionally left for the reader to try parsing the values themselves.</p>
<pre><code class="hljs css js"><span class="hljs-keyword">const</span> name = <span class="hljs-string">'Red Pulse Token 3.1.4'</span>
<span class="hljs-keyword">const</span> decimals = <span class="hljs-number">8</span>
<span class="hljs-keyword">const</span> symbol = <span class="hljs-string">'RPX'</span>
<span class="hljs-keyword">const</span> totalSupply = <span class="hljs-number">43467000.00000000</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="basic_claimgas.html">← Basic - Claiming Gas</a><a class="docs-next button" href="basic_invoke.html">下一页 →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/neon-js/" class="nav-home"><img src="/neon-js/img/logo.svg" alt="neon-js" width="66" height="58"/></a><div><h5>Docs</h5><a href="/neon-js/docs/zh-CN/installation.html">Getting Started</a><a href="/neon-js/docs/zh-CN/tutorial.html">Guides</a><a href="/neon-js/docs/zh-CN/api.html">API Reference</a></div><div><h5>Community</h5><a href="/neon-js/zh-CN/users.html">User Showcase</a><a href="https://neo.stackexchange.com/" target="_blank">Stack Overflow</a><a href="https://discord.gg/wczVXTN">Discord Chat</a><a href="https://www.reddit.com/r/NEO/" target="_blank">NEO Reddit</a></div><div><h5>More</h5><a href="https://neo.org/" target="_blank">NEO</a><a href="https://github.com/cityofzion/neon-js" target="_blank">GitHub</a><a class="github-button" href="https://github.com/cityofzion/neon-js" data-icon="octicon-star" data-count-href="/cityofzion/neon-js/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="http://cityofzion.io" target="_blank" class="fbOpenSource"><img src="/neon-js/img/coz_med.png" alt="City of Zion" width="150" height="150"/></a><section class="copyright">Copyright © 2018 City of Zion</section></footer></div></body></html>