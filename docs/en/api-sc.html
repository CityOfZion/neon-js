<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Smart Contract · neon-js</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The Smart Contract module is exposed as:"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Smart Contract · neon-js"/><meta property="og:type" content="website"/><meta property="og:url" content="http://cityofzion.io/neon-js/index.html"/><meta property="og:description" content="The Smart Contract module is exposed as:"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/neon-js/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://unpkg.com/@cityofzion/neon-js"></script><link rel="stylesheet" href="/neon-js/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/neon-js/en"><img class="logo" src="/neon-js/img/logo.svg" alt="neon-js"/><h2 class="headerTitleWithLogo">neon-js</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/neon-js/docs/en/installation.html" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/neon-js/docs/en/api-index.html" target="_self">API</a></li><li class=""><a href="/neon-js/docs/en/changelog-latest.html" target="_self">Changelog</a></li><li class=""><a href="/neon-js/en/help.html" target="_self">Help</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/neon-js/img/language.svg"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/neon-js/docs/zh-CN/api-sc.html">中文</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Modules</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-index.html">API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Modules</h3><ul><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-wallet.html">Wallet</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-transactions.html">Transactions</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-rpc.html">RPC</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/neon-js/docs/en/api-sc.html">Smart Contract</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-api.html">API</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-u.html">Utility</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-CONST.html">Constants</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-settings.html">Settings</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/api-logging.html">Logging</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Smart Contract</h1></header><article><div><span><p>The Smart Contract module is exposed as:</p>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">import</span> Neon <span class="hljs-keyword">from</span> <span class="hljs-string">'@cityofzion/neon-js'</span>
<span class="hljs-keyword">const</span> sb = Neon.create.scriptBuilder()

<span class="hljs-keyword">import</span> {sc} <span class="hljs-keyword">from</span> <span class="hljs-string">'@cityofzion/neon-js'</span>
<span class="hljs-keyword">const</span> sb = <span class="hljs-keyword">new</span> sc.scriptBuilder()
</code></pre>
<p>In NEO, users interact with smart contracts through InvocationTransactions. These transactions carry the hex output from scriptBuilder and assets involved to the network for processing.</p>
<p>To test out smart contracts, you are better off using RPC calls:</p>
<ul>
<li><code>invoke</code></li>
<li><code>invokefunction</code></li>
<li><code>invokescript</code></li>
</ul>
<p>These are implemented in v2.3.3. These RPC calls execute the provided script and returns the result based on the current blockchain state. However, it is not actually recorded on the chain. Thus, their purpose is to test out the script to ensure validity and find out the gas cost required.</p>
<p>For example, in the NEP5 token standard, we do not require an actual transaction to retrieve the name or symbol of the token. Thus, it is better to use a <code>invoke</code> RPC call instead of a real invocationTransaction.</p>
<p>We will use a transaction when we want to effect a state change. For example, we want to transfer tokens from address A to B. We will use invoke to ensure the script is valid before sending the actual transaction.</p>
<h2><a class="anchor" aria-hidden="true" id="classes"></a><a href="#classes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Classes</h2>
<h3><a class="anchor" aria-hidden="true" id="scriptbuilder"></a><a href="#scriptbuilder" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ScriptBuilder</h3>
<p>The <code>ScriptBuilder</code> is an object that converts a smart contract method call into a hexstring that can be sent to the network with a InvocationTransaction.</p>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">import</span> Neon, {rpc} <span class="hljs-keyword">from</span> <span class="hljs-string">'@cityofzion/neon-js'</span>
<span class="hljs-keyword">const</span> sb = Neon.create.scriptBuilder()
<span class="hljs-comment">// Build script to call 'name' from contract at 5b7074e873973a6ed3708862f219a6fbf4d1c411</span>
sb.emitAppCall(<span class="hljs-string">'5b7074e873973a6ed3708862f219a6fbf4d1c411'</span>, <span class="hljs-string">'name'</span>)

<span class="hljs-comment">// Test the script with invokescript</span>
rpc.Query.invokeScript(sb.str).execute(nodeURL)

<span class="hljs-comment">// Create InvocationTransaction for real execution</span>
<span class="hljs-keyword">const</span> tx = Neon.create.invocationTx(publicKey, {}, {}, sb.str, <span class="hljs-number">0</span>)
</code></pre>
<p>You may chain multiple calls together in a single VM script. The results will be returned in order.</p>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">import</span> Neon, {rpc} <span class="hljs-keyword">from</span> <span class="hljs-string">'@cityofzion/neon-js'</span>
<span class="hljs-keyword">const</span> sb = Neon.create.scriptBuilder()
sb.emitAppCall(scriptHash, <span class="hljs-string">'name'</span>)
.emitAppCall(scriptHash, <span class="hljs-string">'symbol'</span>)

<span class="hljs-comment">// Returns name, symbol</span>
rpc.Query.invokeScript(sb.str)
  .execute(Neon.CONST.DEFAULT_RPC.MAIN)
  .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(res)
  })
</code></pre>
<p>A simple wrapper method is provided for convenience.</p>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">import</span> Neon <span class="hljs-keyword">from</span> <span class="hljs-string">'@cityofzion/neon-js'</span>
<span class="hljs-keyword">const</span> props = {
  <span class="hljs-attr">scriptHash</span>: Neon.CONST.CONTRACTS.TEST_RPX,
  <span class="hljs-attr">operation</span>: <span class="hljs-string">'name'</span>,
  <span class="hljs-attr">args</span>: []
}
<span class="hljs-comment">// Returns a hexstring</span>
<span class="hljs-keyword">const</span> vmScript = Neon.create.script(props)
</code></pre>
<p>The ScriptBuilder can also reverse scripts back to its arguments. However, this process is not a complete reverse engineer due to the varied nature of arguments. The arguments are returned as hexstrings and it is left to the developer to parse them meaningfully.</p>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">const</span> sb = <span class="hljs-keyword">new</span> sb.ScriptBuilder(<span class="hljs-string">'00c1046e616d65675f0e5a86edd8e1f62b68d2b3f7c0a761fc5a67dc'</span>)
<span class="hljs-keyword">const</span> params = sb.toScriptParams()
params = [{
      <span class="hljs-string">"scriptHash"</span>: <span class="hljs-string">"dc675afc61a7c0f7b3d2682bf6e1d8ed865a0e5f"</span>,
      <span class="hljs-string">"args"</span>: [
        <span class="hljs-string">"6e616d65"</span>, <span class="hljs-comment">// 'name' in hexstring</span>
        []
      ],
      <span class="hljs-string">"useTailCall"</span>: <span class="hljs-literal">false</span>
    }]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="contractparam"></a><a href="#contractparam" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ContractParam</h3>
<p>ContractParam objects provide a convenient way to construct calls for <code>invoke</code> and <code>invokefunction</code>. These RPC calls utilise a JSON struct for arguments and can be messy to create by hand:</p>
<pre><code class="hljs css languages- js">  {
    <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-string">'this is a string'</span>
  }
</code></pre>
<p>ContractParam currently supports creating string, boolean, integer, bytearray and array.</p>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">import</span> Neon, {sc, rpc, CONST} <span class="hljs-keyword">from</span> <span class="hljs-string">'@cityofzion/neon-js'</span>
<span class="hljs-keyword">const</span> param1 = Neon.create.contractParam(<span class="hljs-string">'String'</span>, <span class="hljs-string">'balanceOf'</span>)
<span class="hljs-comment">// This is a convenient way to convert an address to a reversed scriptHash that smart contracts use.</span>
<span class="hljs-keyword">const</span> param2 = sc.ContractParam.byteArray(<span class="hljs-string">'AVf4UGKevVrMR1j3UkPsuoYKSC4ocoAkKx'</span>, <span class="hljs-string">'address'</span>)

rpc.Query.invoke(CONST.CONTRACTS.TEST_RPX, param1, sc.ContractParam.array(param2))
  .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(res)
  })
</code></pre>
<p>ContractParams are compatible with ScriptBuilder so it is fine to pass them in as arguments directly.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/neon-js/docs/en/api-rpc.html">← RPC</a><a class="docs-next button" href="/neon-js/docs/en/api-api.html">API →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/neon-js/" class="nav-home"><img src="/neon-js/img/logo.svg" alt="neon-js" width="66" height="58"/></a><div><h5>Docs</h5><a href="/neon-js/docs/en/installation.html">Getting Started</a><a href="/neon-js/docs/en/tutorial.html">Guides</a><a href="/neon-js/docs/en/api.html">API Reference</a></div><div><h5>Community</h5><a href="/neon-js/en/users.html">User Showcase</a><a href="https://neo.stackexchange.com/" target="_blank">Stack Overflow</a><a href="https://discord.gg/wczVXTN">Discord Chat</a><a href="https://www.reddit.com/r/NEO/" target="_blank">NEO Reddit</a></div><div><h5>More</h5><a href="https://neo.org/" target="_blank">NEO</a><a href="https://github.com/cityofzion/neon-js" target="_blank">GitHub</a><a class="github-button" href="https://github.com/cityofzion/neon-js" data-icon="octicon-star" data-count-href="/cityofzion/neon-js/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="http://cityofzion.io" target="_blank" class="fbOpenSource"><img src="/neon-js/img/coz_med.png" alt="City of Zion" width="150" height="150"/></a><section class="copyright">Copyright © 2018 City of Zion</section></footer></div></body></html>